# OLLM
This repository stores all the experiment data in the paper A Study of Using Multimodal LLMs for Non-Crash Functional Bug Detection in Android Apps


## Artifact Description
This is the artifact for the paper: A Study of Using Multimodal LLMs for Non-Crash Functional Bug Detection in Android Apps.

The artifact shows:

1) Source code for the experiments (./Code/).
2) Experiment results presented in the paper(./Experiment Data).
3) Programs (i.e., APKs), bug reports, and text sequences generated in the paper (./Experiment Data/Experiments-Feb2024/test sequence).
4) Prompts used to get the LLM feedback (./Experiment Data/RQ/Prompts).


## Run our Experiment Source Code
1) Create Android Emulator Pixel 2, API 28， Android 9.0 ('Pie') x86 in Android Studio, and open the emulator.
2) Get the emulator device number, in Linux cmd run ’adb devices’, and replace the number in d = Device("emulator-5554") in the source code with the device number of your own.
3) Install the APK and drag the APK into the emulator. Open the app in your emulator.
4) In the same category with the source code file, create a txt file named action.txt, and store the action text in it. the format of the action text should be 'Action NameOfUIElement'.
   For Example:
```sh
click Allow
click Allow
click com.ichi2.anki:id/action_sync
click LOG IN
click Email address
```
The action text can either be defined by the human tester or by an automatic sequence generator.
5) Change the folder name in the script for each bug, the variable folder_name = 'XXX', XXX is the id of the bug.
6) Get the source code from the code category(./code/) and put it in the same category of the action.txt


## Description of Input Files of Experiment Source Code:
* The input file of the tool is a Txt file named 'action.txt'.
* The APK file of the app.


## Description of Result Files Generated By Our Code:
* The output path of the tool is in ``/*bugid/``.
* Open the folder and you'll see the .xml file and screenshot of each step of the app after execution.
* The text sequence containing text extracted from UI and the actions will be stored in a file named ``prompt_v1_*bugid.txt``.
* Use the pre-prompt in the prompt folder (./prompt/) and the text sequence for LLMs the format should be pre-prompt, LLM Response, text sequence, LLM decision.

## Description Experiment Files:
* Evaluation.xlsx is a form that records the bug id, the bug name, the result of the experiments, and the URL of the LLM responses.
* The Folder (./Experiments-Feb2024) Contains the records of experiments done in February 2024, which are the reference of studying the LLM response changes over time.
* The Folder (./Experiments-July2024) Contains the records of experiments done in July 2024, which are the reference of studying the LLM response changes over time.
* In the above folders, there are folders for each research question,  containing the experiment data as evidence of the conclusion. For example, (./Experiment Data/Experiments-July2024/RQ1 Effectiveness and Efficiency of detecting NCF bugs)
* There's a test sequence folder containing all of the test sequences we generated for the bugs.
* For each experiment, there's a folder containing the prompts (for example, ./Experiment Data/Experiments-July2024/RQ1 Effectiveness and Efficiency of detecting NCF bugs/GPT4o-TP-FN/Prompts) and a folder containing the LLM responses(./Experiment Data/Experiments-July2024/RQ1 Effectiveness and Efficiency of detecting NCF bugs/GPT4o-TP-FN/Prompt1-LLMResponse).

## Text Sequence Generation Tool
* The text sequence generation tool used in the paper can automatically browse the app and generate text sequences in the desired format (action+ GUI text extraction).
* Download the tool: https://drive.google.com/file/d/1_rtSx0uVhh9QeOkyAXSCrPqqpPmDxh_5/view?usp=sharing

## How to Run Text Sequence Generation Tool:
* Extract the zip file
* Put the APK file in the dataset/unfinished folder
* In the folder, run 
```sh
python2 ./RunTest.py
```
## APKs and suggested emulator info
The APK file of the experiment data is in the test sequence folder

* Amaze	Pixel 3A, API34,x86_64, Android14.0
* Ankidroid	Pixel7pro, API31, x86_64, Android12.0
* AntennaPod	Pixel7pro, API28, x86, Android 9.0
* NewPipe	Pixel7pro, API28, x86, Android 9.0
* WordPress	Pixel7pro, API28, x86, Android 9.0
* SimpleNote	Pixel7pro, API28, x86, Android 9.0
* Firefox	Pixel7pro, API28, x86, Android 9.0

All APIs we used: 21, 28, 30, 31, 33, 34, please adjust to the working API for each of the apps.
* Apps for real-world bugs: Android 4.4
* APKs for real-world bugs:https://drive.google.com/file/d/1qdw4eZjg4sr68serv0yuPvmeh66H4hfE/view?usp=sharing

